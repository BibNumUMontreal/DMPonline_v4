<!-- Create a new project (3 dropdowns = 6 options) -->
<%= semantic_form_for @project, :url => {:controller => :projects, :action => :create }, :html=>{:method=>:post} do |f| %>
<%= f.inputs do %>
<div class="createa-project">
    <h1> <%= t('helpers.project.create_page.title')%> </h1>
    <div class="info-new-project">
        <p>
            <%= raw t('helpers.project.create_page.desc')%>
        </p>
    </div>
    <div class="dropdowns">
        <!-- dropdown 1 = funders -->
        <div class="control-group">
            <div class="controls">
                <% org_type_funder = OrganisationType.find_by_name(t('helpers.org_type.funders')).organisations.order() %>
                <%= f.input :funder_id, :as => :select, :collection => org_type_funder, :label => t('helpers.funders_question'), :input_html => { :multiple => false, :class => "typeahead" }, :include_blank =>  t('helpers.org_type.funders') %>
                <div class="create_project_question_descriptions">
                	<%= t('helpers.funders_question_description')%>
                </div>
                <% org_template = Dmptemplate.templates_org_type(t('helpers.org_type.funders') ) %>
                <% if org_template.length > 1  then %>
                <div id="has_more_templates">
                    <%= f.input :dmptemplate, :as => :select, :collection => org_template, :label => t('helpers.org_type.templates'), :input_html => { :multiple => false, :class => "typeahead" } %>
                </div>
                <% end %>
            </div>
        </div>

        <!-- dropdown 2 = institution -->
        <div class="control-group">
            <div class="controls">
                <% org_type_inst = OrganisationType.find_by_name(t('helpers.org_type.institution')).organisations.order("name") %>
                <% unless current_user.organisation.nil? %>
									<% user_inst = current_user.organisation.root %>
									<% org_type_inst.unshift(user_inst) %>
                <% end %>
                <%= f.input :institution_id, :as => :select, :collection => org_type_inst, :label => t('helpers.institution_question'), :input_html => { :multiple => false, :class => "typeahead" }, :include_blank =>  t('helpers.org_type.institution')  %>
                <div class="create_project_question_descriptions">
                	<%= t('helpers.institution_question_description')%>
                </div>
                <!-- verify if org has children-->
                <% children_info = Organisation.orgs_with_parent_of_type(t('helpers.org_type.institution')) %>
                <% if children_info.any? %>
                <div class="has_children">
                    <%= f.input :unit_id, :as => :select, :collection => children_info, :input_html => { :multiple => false, :class => "typeahead" }  %>
                </div >
                <% end %>
            </div>
        </div>

        <!-- dropdown 3 = other guidance -->
        <div class="control-group">
        	<div class="controls">
        		<% covered_orgs = org_type_funder + org_type_inst + children_info %>
        		<% other_guidance = GuidanceGroup.guidance_groups_excluding(covered_orgs) %>
        		<%= f.input :guidance_groups, :as => :check_boxes, :collection => other_guidance, :label => t('helpers.other_guidance_question'), :member_label => :display_name %>
        	</div>
        </div>

    </div>
</div>
<% end %>
<!-- submit buttons -->
<%= f.actions do %>
	<a data-toggle="modal" href="#project-confirmation-dialog" class="btn btn-primary">Create plan</a>
<% end %>
<% end %> 